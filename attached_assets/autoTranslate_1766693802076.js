const autoTranslate = {
  dictionary: {
    en: {},
    es: {
      // Dashboard
      "Dashboard": "Panel de Control",
      "Overview of your messaging and reviews.": "Resumen de tus mensajes y reseÃ±as.",
      "Reputation Score": "PuntuaciÃ³n de ReputaciÃ³n",
      "Marketing List": "Lista de Marketing",
      "Sent Today": "Enviados Hoy",
      "vs yesterday": "vs ayer",
      "Sent This Week": "Enviados Esta Semana",
      "+12% vs last week": "+12% vs semana pasada",
      "Recent Activity": "Actividad Reciente",
      "Real-time updates from your shop": "Actualizaciones en tiempo real de tu negocio",
      "View All": "Ver Todo",
      "Quick Send": "EnvÃ­o RÃ¡pido",
      "Instantly reach a customer without leaving the dashboard.": "Contacta a un cliente sin salir del panel.",
      "PHONE NUMBER": "NÃšMERO DE TELÃ‰FONO",
      "MESSAGE": "MENSAJE",
      "Select a template...": "Selecciona una plantilla...",
      "Your device is ready for pickup...": "Tu dispositivo estÃ¡ listo para recoger...",
      "Send Notification": "Enviar NotificaciÃ³n",
      "New Message": "Nuevo Mensaje",
      "New Review Request": "Nueva Solicitud de ReseÃ±a",
      "SMS Sent": "SMS Enviado",
      "ago": "atrÃ¡s",
      
      // Send SMS / New Customer Onboarding
      "New Customer Onboarding": "Registro de Nuevo Cliente",
      "Upload a receipt to auto-fill details. Review and correct AI data before saving.": "Sube un recibo para autocompletar. Revisa y corrige los datos de IA antes de guardar.",
      "Upload Receipt": "Subir Recibo",
      "Review Customer": "Revisar Cliente",
      "Send Message": "Enviar Mensaje",
      "Drag & Drop Receipt": "Arrastra y Suelta el Recibo",
      "Supports JPG, HEIC, PNG": "Soporta JPG, HEIC, PNG",
      "Browse Files": "Buscar Archivos",
      "Camera": "CÃ¡mara",
      "Import from POS": "Importar del POS",
      "Privacy First": "Privacidad Primero",
      "Receipts are processed securely by OpenAI and are discarded immediately after extraction.": "Los recibos son procesados de forma segura por OpenAI y se eliminan inmediatamente despuÃ©s de la extracciÃ³n.",
      "DETECTED FROM RECEIPT": "DETECTADO DEL RECIBO",
      "Name:": "Nombre:",
      "Phone:": "TelÃ©fono:",
      "Device:": "Dispositivo:",
      "Repair:": "ReparaciÃ³n:",
      "Customer Profile": "Perfil del Cliente",
      "Editable": "Editable",
      "Review carefully": "Revisar cuidadosamente",
      "CUSTOMER NAME": "NOMBRE DEL CLIENTE",
      "Identify from receipt...": "Identificar del recibo...",
      "PHONE NUMBER": "NÃšMERO DE TELÃ‰FONO",
      "DEVICE": "DISPOSITIVO",
      "Device Model": "Modelo del Dispositivo",
      "COST": "COSTO",
      "REPAIR TYPE": "TIPO DE REPARACIÃ“N",
      "Service description...": "DescripciÃ³n del servicio...",
      "MESSAGE TYPE": "TIPO DE MENSAJE",
      "Google Review Request": "Solicitud de ReseÃ±a Google",
      "MESSAGE PREVIEW": "VISTA PREVIA DEL MENSAJE",
      
      // Campaigns
      "Campaigns": "CampaÃ±as",
      "Launch targeted reactivation campaigns for your customers.": "Lanza campaÃ±as de reactivaciÃ³n dirigidas para tus clientes.",
      "Bulk Review Sender": "EnvÃ­o Masivo de ReseÃ±as",
      "Send review requests to multiple customers": "EnvÃ­a solicitudes de reseÃ±a a mÃºltiples clientes",
      "RepairDesk Tickets": "Tickets de RepairDesk",
      "Needs Follow-up": "Necesita Seguimiento",
      "Quick Filters:": "Filtros RÃ¡pidos:",
      "High Value Repairs": "Reparaciones de Alto Valor",
      "iPhone Users": "Usuarios de iPhone",
      "Last 30 Days": "Ãšltimos 30 DÃ­as",
      "Search device or name...": "Buscar dispositivo o nombre...",
      "Completed Only": "Solo Completados",
      "Repaired & Collected": "Reparado y Recogido",
      "In Progress": "En Progreso",
      "Never Contacted": "Nunca Contactado",
      
      // History
      "Message History": "Historial de Mensajes",
      "Track all sent messages and follow-ups": "Rastrea todos los mensajes enviados y seguimientos",
      "All Messages": "Todos los Mensajes",
      "Clicked Links": "Enlaces Clickeados",
      "With Feedback": "Con Comentarios",
      "Legend:": "Leyenda:",
      "Review": "ReseÃ±a",
      "Clicked": "Clickeado",
      "Review Posted": "ReseÃ±a Publicada",
      "Sent": "Enviado",
      "Clear Filters": "Limpiar Filtros",
      
      // Customers
      "Customer Database": "Base de Datos de Clientes",
      "Manage your customer contacts": "Administra tus contactos de clientes",
      
      // Reviews
      "Google Reviews": "ReseÃ±as de Google",
      "AI-powered review management": "GestiÃ³n de reseÃ±as con IA",
      "Pending Reviews": "ReseÃ±as Pendientes",
      "Posted Replies": "Respuestas Publicadas",
      "Ignored": "Ignoradas",
      "Avg Rating": "CalificaciÃ³n Promedio",
      "Pending": "Pendientes",
      "Posted": "Publicadas",
      "Generate AI Reply": "Generar Respuesta IA",
      "Post Reply": "Publicar Respuesta",
      "Ignore": "Ignorar",
      
      // Feedback
      "Feedback Inbox": "BuzÃ³n de Comentarios",
      "Review and respond to customer feedback": "Revisa y responde a los comentarios de clientes",
      "Unread": "No LeÃ­dos",
      "Resolved": "Resueltos",
      "All": "Todos",
      "Mark Read": "Marcar LeÃ­do",
      "Send Apology": "Enviar Disculpa",
      "Call": "Llamar",
      "Block": "Bloquear",
      
      // Billing
      "Billing & Subscription": "FacturaciÃ³n y SuscripciÃ³n",
      "Manage your plan and payment methods": "Administra tu plan y mÃ©todos de pago",
      "Current Plan": "Plan Actual",
      "Next Billing": "PrÃ³xima FacturaciÃ³n",
      "Update Payment Method": "Actualizar MÃ©todo de Pago",
      "View Invoices": "Ver Facturas",
      "Change Plan": "Cambiar Plan",
      "Cancel Subscription": "Cancelar SuscripciÃ³n",
      
      // Settings
      "Settings": "ConfiguraciÃ³n",
      "Configure your ReviewGuard account": "Configura tu cuenta de ReviewGuard",
      "Business Information": "InformaciÃ³n del Negocio",
      "Business Name": "Nombre del Negocio",
      "Google Review Link": "Enlace de ReseÃ±a Google",
      "SMS Settings": "ConfiguraciÃ³n de SMS",
      "Sender Name": "Nombre del Remitente",
      "Default Template": "Plantilla Predeterminada",
      "Notifications": "Notificaciones",
      "Email Notifications": "Notificaciones por Email",
      "SMS Notifications": "Notificaciones por SMS",
      "Save Settings": "Guardar ConfiguraciÃ³n",
      "Save Changes": "Guardar Cambios",
      "Integrations": "Integraciones",
      "Telegram Bot": "Bot de Telegram",
      "Connect": "Conectar",
      "Connected": "Conectado",
      "Disconnect": "Desconectar",
      "Business Type / Industry": "Tipo de Negocio / Industria",
      
      // Common
      "Loading...": "Cargando...",
      "Save": "Guardar",
      "Cancel": "Cancelar",
      "Send": "Enviar",
      "Edit": "Editar",
      "Delete": "Eliminar",
      "Confirm": "Confirmar",
      "Close": "Cerrar",
      "Search": "Buscar",
      "Filter": "Filtrar",
      "Retry": "Reintentar",
      "Yes": "SÃ­",
      "No": "No",
      "OK": "OK",
      "Error": "Error",
      "Success": "Ã‰xito",
      "Warning": "Advertencia",
      
      // Modals
      "Confirm SMS": "Confirmar SMS",
      "Send to": "Enviar a",
      "Phone number": "NÃºmero de telÃ©fono",
      "Message preview": "Vista previa del mensaje",
      "Confirm & Send": "Confirmar y Enviar",
      "Import from RepairDesk": "Importar de RepairDesk",
      "Select a ticket to auto-fill customer details": "Selecciona un ticket para autocompletar datos del cliente",
      "Loading tickets...": "Cargando tickets...",
      "Failed to load tickets": "Error al cargar tickets",
      "No recent tickets found": "No se encontraron tickets recientes",
      "Take Photo": "Tomar Foto",
      "Capture Photo": "Capturar Foto",
      
      // Templates dropdown
      "ðŸ“¦ Device ready for pickup": "ðŸ“¦ Dispositivo listo para recoger",
      "â³ Repair delayed - will update soon": "â³ ReparaciÃ³n retrasada - actualizaremos pronto",
      "â­ Please leave us a review": "â­ Por favor dÃ©janos una reseÃ±a",
      "âœï¸ Custom message": "âœï¸ Mensaje personalizado",
      "ðŸŒŸ Google Review Request": "ðŸŒŸ Solicitud de ReseÃ±a Google",
      
      // Notifications
      "SMS sent successfully!": "Â¡SMS enviado exitosamente!",
      "Failed to send SMS": "Error al enviar SMS",
      "Reminder sent successfully!": "Â¡Recordatorio enviado exitosamente!",
      "Settings saved successfully!": "Â¡ConfiguraciÃ³n guardada exitosamente!",
      "Reply posted successfully!": "Â¡Respuesta publicada exitosamente!",
      "Customer data loaded!": "Â¡Datos del cliente cargados!",
      "Feedback marked as read": "Comentario marcado como leÃ­do",
      "An error occurred": "OcurriÃ³ un error",
      
      // HVAC / Field Service specific
      "Unit / System": "Unidad / Sistema",
      "Trane XL, AC Unit, Heater...": "Trane XL, Aire Acondicionado, Calefactor...",
      "AC Unit, Furnace, Heat Pump, etc.": "Aire Acondicionado, CalefacciÃ³n, Bomba de Calor, etc.",
      "Service Performed": "Servicio Realizado",
      "Service Type": "Tipo de Servicio",
      "Seasonal Tune-up, Coil Cleaning...": "Mantenimiento estacional, Limpieza de bobina...",
      "Service Authorization Verified": "AutorizaciÃ³n de Servicio Verificada",
      "Service Address": "DirecciÃ³n del Servicio",
      "123 Main St, Miami FL": "123 Calle Principal, Miami FL",
      "Helps identify the job for field service": "Ayuda a identificar el trabajo para servicios en campo",
      "Connect ServiceTitan": "Conectar ServiceTitan",
      "âœ… Service complete at your location": "âœ… Servicio completado en su ubicaciÃ³n",
      "ðŸ”§ Parts on order - will reschedule": "ðŸ”§ Piezas en pedido - reprogramaremos",
      
      // Auto Repair specific
      "Vehicle": "VehÃ­culo",
      "2020 Honda Civic, Ford F-150, etc.": "2020 Honda Civic, Ford F-150, etc.",
      "Vehicle Service Consent Verified": "Consentimiento de Servicio de VehÃ­culo Verificado",
      "ðŸš— Your vehicle is ready for pickup": "ðŸš— Su vehÃ­culo estÃ¡ listo para recoger",
      
      // Plumbing specific
      "Issue / System": "Problema / Sistema",
      "Water heater, Drain, Pipe leak, etc.": "Calentador de agua, Drenaje, Fuga de tuberÃ­a, etc.",
      "ðŸ”§ Plumbing service complete": "ðŸ”§ Servicio de plomerÃ­a completado",
      
      // Field service statuses
      "Scheduled": "Programado",
      "Technician En Route": "TÃ©cnico en Camino",
      "Completed": "Completado",
      
      // In-shop statuses
      "Received": "Recibido",
      "Ready for Pickup": "Listo para Recoger",
      "Picked Up": "Recogido",
      "Checked In": "Registrado",
      "Diagnosing": "Diagnosticando",
      "Repairing": "Reparando",
      
      // Vertical selector
      "Business Type / Industry": "Tipo de Negocio / Industria",
      "In-Shop (Customer comes to you)": "En Tienda (El cliente viene a ti)",
      "Field Service (You go to customer)": "Servicio en Campo (TÃº vas al cliente)",
      "Repair Shop (Electronics, Phone, Computer)": "Taller de ReparaciÃ³n (ElectrÃ³nica, TelÃ©fono, Computadora)",
      "Auto Repair": "Taller Automotriz",
      "HVAC / Air Conditioning": "HVAC / Aire Acondicionado",
      "Plumbing": "PlomerÃ­a",
      "Changes templates and terminology to match your industry": "Cambia plantillas y terminologÃ­a segÃºn tu industria",
      
      // Dynamic labels from verticalConfig
      "Technician Notes": "Notas del TÃ©cnico",
      "Job Completed": "Trabajo Completado",
      "your location": "su ubicaciÃ³n",
      "Service complete": "Servicio completado",
      "Device ready": "Dispositivo listo",
      
      // Dynamic POS integration strings
      "Connect ServiceTitan (Coming Soon)": "Conectar ServiceTitan (PrÃ³ximamente)",
      "Connect Shop-Ware (Coming Soon)": "Conectar Shop-Ware (PrÃ³ximamente)",
      "Connect Vagaro (Coming Soon)": "Conectar Vagaro (PrÃ³ximamente)",
      "Connect Square (Coming Soon)": "Conectar Square (PrÃ³ximamente)",
      "(Coming Soon)": "(PrÃ³ximamente)",
      
      // Time
      "1d ago": "hace 1d",
      "2d ago": "hace 2d",
      "19h ago": "hace 19h",
      "today": "hoy",
      "yesterday": "ayer",
      "this week": "esta semana",
      "+5 this week": "+5 esta semana"
    }
  },

  currentLang: 'en',

  init() {
    this.currentLang = localStorage.getItem('lang') || (navigator.language.startsWith('es') ? 'es' : 'en');
    if (this.currentLang !== 'en') {
      this.translatePage();
    }
    this.observeChanges();
  },

  translatePage() {
    if (this.currentLang === 'en') return;
    
    const dict = this.dictionary[this.currentLang];
    if (!dict) return;

    this.translateElement(document.body, dict);
  },

  translateElement(root, dict) {
    const walker = document.createTreeWalker(
      root,
      NodeFilter.SHOW_TEXT,
      null,
      false
    );

    const textNodes = [];
    let node;
    while (node = walker.nextNode()) {
      textNodes.push(node);
    }

    textNodes.forEach(textNode => {
      const text = textNode.textContent.trim();
      if (text && dict[text]) {
        textNode.textContent = textNode.textContent.replace(text, dict[text]);
      }
    });

    root.querySelectorAll('input[placeholder], textarea[placeholder]').forEach(el => {
      const ph = el.placeholder;
      if (dict[ph]) {
        el.placeholder = dict[ph];
      }
    });

    root.querySelectorAll('option').forEach(el => {
      const text = el.textContent.trim();
      if (dict[text]) {
        el.textContent = dict[text];
      }
    });

    root.querySelectorAll('[title]').forEach(el => {
      const title = el.title;
      if (dict[title]) {
        el.title = dict[title];
      }
    });
  },

  observeChanges() {
    const observer = new MutationObserver((mutations) => {
      if (this.currentLang === 'en') return;
      
      mutations.forEach(mutation => {
        mutation.addedNodes.forEach(node => {
          if (node.nodeType === Node.ELEMENT_NODE) {
            this.translateElement(node, this.dictionary[this.currentLang]);
          }
        });
      });
    });

    observer.observe(document.body, {
      childList: true,
      subtree: true
    });
  },

  setLanguage(lang) {
    this.currentLang = lang;
    localStorage.setItem('lang', lang);
    
    if (typeof updatePreview === 'function') {
      setTimeout(() => updatePreview(), 100);
    }
    
    location.reload();
  },

  updateButtonStates() {
    const enBtn = document.getElementById('btn-lang-en');
    const esBtn = document.getElementById('btn-lang-es');
    
    if (enBtn && esBtn) {
      if (this.currentLang === 'en') {
        enBtn.className = 'px-2 py-1 rounded text-xs font-medium bg-accent text-white';
        esBtn.className = 'px-2 py-1 rounded text-xs font-medium bg-slate-700 text-slate-300';
      } else {
        enBtn.className = 'px-2 py-1 rounded text-xs font-medium bg-slate-700 text-slate-300';
        esBtn.className = 'px-2 py-1 rounded text-xs font-medium bg-accent text-white';
      }
    }
  }
};

window.setLanguage = (lang) => autoTranslate.setLanguage(lang);

document.addEventListener('DOMContentLoaded', () => {
  setTimeout(() => {
    autoTranslate.init();
    autoTranslate.updateButtonStates();
  }, 150);
});
